# nodeé«˜çº§ç¯‡ä»£ç 
> è®°å½•è‡ªå·±å­¦ä¹ nodeé«˜çº§çš„è¿‡ç¨‹

<br/>

## 01-async-event
nodeä¸­æ•°æ®é©±åŠ¨çš„ä½“éªŒï¼Œ`EventEmitter`.

<br/>

## 02-single-thread
node v8æ‰§è¡Œçš„ä¸»çº¿ç¨‹ä¸ºå•çº¿ç¨‹ï¼Œä½“éªŒå•çº¿ç¨‹åœ¨cpuå µå¡æƒ…å†µä¸‹çš„åœºæ™¯ï¼Œåˆç†ä½¿ç”¨libuvåº“è¿›è¡Œå¼‚æ­¥å¹¶å‘æ“ä½œï¼

<br/>

## 03-ts-node-http-server
node + ts + express å¿«é€Ÿå»ºç«‹httpæœåŠ¡

<br/>

## 04-node-global
nodeå…¨å±€å¯¹è±¡/å±æ€§

<br/>

## 05-process
node processå¯¹è±¡/å±æ€§

<br/>

## 06-path
pathæ¨¡å—

<br/>

## ğŸš€07-buffer
bufferå¯¹è±¡

<br/>

## 08-buffer
fsæ¨¡å—

<br/>

## 09-md2html
md è½¬ htmlåˆ©ç”¨pathã€fsæ¨¡å—å¹¶å®ç°ç›‘å¬å†™å…¥å¦ä¸€ä¸ªæ–‡ä»¶ï¼ˆdemoï¼‰

<br/>

## 10-open-file
fs.open()ã€fs.write()...æ–¹æ³•ç»†èŠ‚å’Œç”¨é€”

<br/>

## 11-copy-file
å¤§æ–‡ä»¶æ‹·è´ä¾‹å­ï¼Œåˆ©ç”¨fsã€bufferç­‰å®ç°ï¼Œå¯¹äºå¤§æ–‡ä»¶å¯ä»¥ç”¨æµæ“ä½œä¼šæ›´å¥½ï¼Œåé¢ä¼šå­¦ä¹ ...

<br/>


# ã€Šæ·±å…¥æµ…å‡ºNode.jsã€‹ç¬”è®°ã€ç²¾å½©éƒ¨åˆ†
## ç¬¬ä¸€ç«  nodeç®€ä»‹
- 1.2.2 ä¸ºä»€ä¹ˆå«Node
  > åŸæ–‡ï¼šNodeå‘å±•ä¸ºä¸€ä¸ªå¼ºåˆ¶ä¸å…±äº«ä»»ä½•èµ„æºçš„å•çº¿ç¨‹ã€å•è¿›ç¨‹ç³»ç»Ÿï¼ŒåŒ…å«ååˆ†é€‚å®œç½‘ç»œçš„åº“ï¼Œä¸ºæ„å»ºå¤§å‹åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºæä¾›åŸºç¡€è®¾æ–½ï¼Œå…¶ç›®æ ‡ä¹Ÿæ˜¯æˆä¸ºä¸€ä¸ªæ„å»ºå¿«é€Ÿã€å¯ä¼¸ç¼©çš„ç½‘ç»œåº”ç”¨å¹³å°ã€‚å®ƒè‡ªèº«éå¸¸ç®€å•ï¼Œé€šè¿‡é€šä¿¡åè®®æ¥ç»„ç»‡è®¸å¤šNodeï¼Œéå¸¸å®¹æ˜“é€šè¿‡æ‰©å±•æ¥è¾¾æˆæ„å»ºå¤§å‹ç½‘ç»œåº”ç”¨çš„ç›®çš„ã€‚æ¯ä¸€ä¸ªNodeè¿›ç¨‹éƒ½æ„æˆè¿™ä¸ªç½‘ç»œåº”ç”¨ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿™æ˜¯å®ƒåå­—æ‰€å«æ„ä¹‰çš„çœŸè°›ã€‚

  æ­¤ä¹ƒNode.jsçœŸè°›ï¼Œåœ¨å‰åå¹´åˆ›é€ å‡ºæ¥å°±è¢«èµ‹äºˆçš„ä½¿å‘½ï¼Œ"åˆ†å¸ƒå¼æ¶æ„"ã€"è½åœ°å¾®æœåŠ¡"ï¼
  
- ç¬¬ä¸€ç« è®²äº†nodeçš„å†å²ã€nodeè¢«èµ‹äºˆçš„ä½¿å‘½ã€nodeçš„å¼ºåŠ¿ç‚¹ã€nodeé€‚ç”¨äºä»€ä¹ˆæ ·çš„åº”ç”¨åœºæ™¯ã€nodeå¼‚æ­¥ç¼–ç¨‹çš„ç‰¹æ€§ã€ä»¥åŠV8å•çº¿ç¨‹å’Œnodeçš„child_processç®€ä»‹...

## ç¬¬äºŒç«  æ¨¡å—æœºåˆ¶
- 2.1.1 Nodeä¸æµè§ˆå™¨ä»¥åŠW3Cç»„ç»‡ã€CommonJSç»„ç»‡ã€ECMAScriptä¹‹é—´çš„å…³ç³»
![](./packages/nodejs%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E7%AC%94%E8%AE%B0/images/Node%E4%B8%8E%E6%B5%8F%E8%A7%88%E5%99%A8%E4%BB%A5%E5%8F%8AW3C%E7%BB%84%E7%BB%87%E3%80%81CommonJS%E7%BB%84%E7%BB%87%E3%80%81ECMAScript%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB.png)
> 2022-05-19ï¼Œç›®å‰EcmaScriptæå‡ºçš„ESModuleè§„èŒƒè¢«Nodejsé‡‡çº³ï¼ŒESè§„èŒƒè‚¯å®šè¦æ›´åŠ æ ‡å‡†ï¼TypeScriptåœ¨ç”¨ESModuleï¼ŒNode v1xä»¥`.mjs`ä¸ºæ–‡ä»¶åç¼€æ‰§è¡ŒESModuleï¼Œæ™®é€šjsæˆ–`.cjs`æ‰§è¡ŒCommonJsè§„èŒƒï¼Œä½†æ˜¯ä¸èƒ½æ··ç”¨ï¼æˆ–`package.json`æ–‡ä»¶ä¿®æ”¹`module`å±æ€§,æ›´å¤šè¯¦ç»†æŸ¥çœ‹nodeå®˜æ–¹æ–‡æ¡£ï¼

<br>

## 2.2ğŸ¥•CommonJSæ¨¡å—åŠ è½½æœºåˆ¶

+ nodeä¸­å¼•å…¥æ¨¡å—ç»å†3ä¸ªæ­¥éª¤ï¼š
  1. è·¯å¾„åˆ†æ
  2. æ–‡ä»¶å®šä½
  3. ç¼–è¯‘æ‰§è¡Œ



+ è·¯å¾„åˆ†æï¼š`æ¨¡å—æ ‡è¯†ç¬¦`åœ¨Nodeä¸­ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ç±»
  + æ ¸å¿ƒæ¨¡å—ï¼Œå¦‚`http`ã€`fs`ã€`path`ç­‰...
  + `"."`æˆ–`".."`å¼€å§‹çš„ç›¸å¯¹è·¯å¾„æ–‡ä»¶æ¨¡å—
  + `"/"`å¼€å§‹çš„ç»å¯¹è·¯å¾„æ–‡ä»¶æ¨¡å—
  + éè·¯å¾„å½¢å¼çš„`node_moduleså†…çš„æ–‡ä»¶æ¨¡å—`ï¼Œå¦‚è‡ªå®šä¹‰çš„connectæ¨¡å—ã€‚



+ æ–‡ä»¶å®šä½ï¼š

  + æ‰©å±•åï¼šå¯ä»¥å¿½ç•¥ä¸å†™ï¼Œcjsä¼šæŒ‰.jsã€.jsonã€.nodeçš„æ¬¡åºè¡¥è¶³æ‰©å±•å

    > require()è¿‡ç¨‹éœ€è¦è°ƒç”¨fsæ¨¡å—åŒæ­¥é˜»å¡å¼åœ°åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚
    > <u>**æ³¨æ„**</u>ï¼šæœ€å¥½å†™å®Œæ•´çš„æ‰©å±•åï¼Œå¯æå‡æ•ˆç‡

  + ç›®å½•åˆ†æå’ŒåŒ…ï¼š
    å¦‚æœæ²¡æŸ¥åˆ°æ–‡ä»¶ä½†æŸ¥åˆ°ç›®å½•ï¼ŒNodeåœ¨å½“å‰ç›®å½•ä¸‹ï¼›
    æŸ¥æ‰¾åˆ°`package.json`è§£æå‡º"main"å­—æ®µï¼Œå¦‚æœç¼ºå°‘æ‰©å±•åï¼Œä¼šå†æ¬¡è¿›å…¥æ‰©å±•ååˆ†ææ­¥éª¤ï¼›
    æœªæŸ¥åˆ°`package.json`ä¾æ¬¡æŸ¥æ‰¾index.jsã€index.jsonã€index.node
    æœªæ‰¾åˆ°ï¼Œé€’å½’ä¸Šå±‚node_modulesåŒ…ï¼Œéƒ½ä¸ºæŸ¥åˆ°ï¼ŒæŠ¥é”™ï¼



+ ç¼–è¯‘æ‰§è¡Œï¼š

  - jsæ–‡ä»¶ï¼šé€šè¿‡fsæ¨¡å—åŒæ­¥è¯»å–æ–‡ä»¶åç¼–è¯‘æ‰§è¡Œ

  - nodeæ–‡ä»¶ï¼šè¿™æ˜¯ç”¨C/C++ç¼–å†™çš„æ‰©å±•æ–‡ä»¶ï¼Œé€šè¿‡dlopen()æ–¹æ³•åŠ è½½æœ€åç¼–è¯‘ç”Ÿæˆçš„æ–‡ä»¶ã€‚

  - jsonæ–‡ä»¶ï¼šé€šè¿‡fsæ¨¡å—åŒæ­¥è¯»å–æ–‡ä»¶åï¼Œç”¨JSON.parse()è§£æè¿”å›ç»“æœã€‚

  - å…¶ä½™æ‰©å±•åï¼šå®ƒä»¬éƒ½è¢«å½“åš.jsæ–‡ä»¶è½½å…¥ã€‚

    > <u>**æ³¨æ„**</u>ï¼šæ¯ä¸€ä¸ªç¼–è¯‘æˆåŠŸçš„æ¨¡å—éƒ½ä¼šå°†å…¶æ–‡ä»¶è·¯å¾„ä½œä¸ºç´¢å¼•ç¼“å­˜åœ¨Module._cacheå¯¹è±¡ä¸Šï¼Œä»¥æé«˜äºŒ æ¬¡å¼•å…¥çš„æ€§èƒ½ã€‚



+ nodeæ¨¡å—åˆ†ä¸¤ç±»ï¼š

  + ğŸ¥•**æ ¸å¿ƒæ¨¡å—**ï¼šnodeæºç ç¼–è¯‘æˆäº†äºŒè¿›åˆ¶æ–‡ä»¶æ‰§è¡Œæ–‡ä»¶ï¼Œå¯åŠ¨æ—¶ä¼šè¢«ç›´æ¥åŠ è½½è¿›å†…å­˜ï¼æ‰€ä»¥è¿™éƒ¨åˆ†æ¨¡å—å¼•å…¥æ—¶æ²¡æœ‰`æ–‡ä»¶å®šä½`ã€`ç¼–è¯‘æ‰§è¡Œ`ä¸¤ä¸ªæ“ä½œï¼å¹¶ä¸”åœ¨`è·¯å¾„åˆ†æ`ä¸­ä¼˜å…ˆåˆ¤æ–­ï¼æ‰€ä»¥åŠ è½½é€Ÿåº¦æœ€å¿«

    > <u>**æ³¨æ„**</u>ï¼šæ ¸å¿ƒæ¨¡å—åŠ è½½ä¼˜å…ˆçº§ä»…æ¬¡äºç¼“å­˜åŠ è½½

  + æ–‡ä»¶æ¨¡å—ï¼šç”¨æˆ·ç¼–å†™ï¼›è¿è¡Œæ—¶åŠ¨æ€åŠ è½½ï¼Œä¼šç»è¿‡å®Œæ•´çš„å¼•å…¥æ¨¡å—çš„ä¸‰ä¸ªæ­¥éª¤ï¼Œé€Ÿåº¦æ…¢äºæ ¸å¿ƒæ¨¡å—

    > 1. è·¯å¾„å½¢å¼çš„æ–‡ä»¶æ¨¡å—ï¼š`"."ã€".."ã€"/"`å¼€å¤´çš„è·¯å¾„ä¼šè§£ææˆçœŸå®è·¯å¾„ä½œä¸ºç´¢å¼•ï¼ŒåŠ è½½æ…¢äºæ ¸å¿ƒæ¨¡å—åŠ è½½
    >
    > 2. è‡ªå®šä¹‰æ¨¡å—ï¼šæŸ¥æ‰¾`node_modules`æ–‡ä»¶æ•°ç»„ï¼Œä»¥å½“å‰ç›®å½•çš„node_moduleså¼€å§‹å¾€çˆ¶çº§node_modulesé€’å½’å‘ä¸ŠæŸ¥æ‰¾ã€‚åŠ è½½é€Ÿåº¦æœ€æ…¢ï¼
    >    <u>**æ³¨æ„**</u>ï¼šå±‚çº§è¶Šæ·±æŸ¥æ‰¾è¶Šæ…¢ï¼è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåŠ è½½é€Ÿåº¦æœ€æ…¢çš„åŸå› ï¼
    >
    >    ```js
    >    console.log(module.paths);
    >    // ç»“æœ
    >    [
    >      '/Users/xiaoqinvar/Desktop/practice/nodeé«˜çº§/packages/node_modules',
    >      '/Users/xiaoqinvar/Desktop/practice/nodeé«˜çº§/node_modules',
    >      '/Users/xiaoqinvar/Desktop/practice/node_modules',
    >      '/Users/xiaoqinvar/Desktop/node_modules',
    >      '/Users/xiaoqinvar/node_modules',
    >      '/Users/node_modules',
    >      '/node_modules'
    >    ]
    >    ```



+ ğŸ¥•**ä¼˜å…ˆä»ç¼“å­˜åŠ è½½**

  > 1. ä¸æµè§ˆå™¨ç¼“å­˜æœºåˆ¶ç±»ä¼¼ï¼ŒNodeå¯¹å¼•å…¥è¿‡çš„æ¨¡å—éƒ½ä¼šè¿›è¡Œç¼“å­˜ï¼Œä»¥å‡å°‘äºŒæ¬¡å¼•å…¥æ—¶çš„å¼€é”€ã€‚ä¸åŒçš„åœ°æ–¹åœ¨äºï¼Œæµè§ˆå™¨ä»…ä»…ç¼“å­˜æ–‡ä»¶ï¼Œè€Œ**Nodeä¼šç¼“å­˜çš„æ˜¯ç¼–è¯‘å’Œæ‰§è¡Œä¹‹åçš„å¯¹è±¡**ã€‚
  >
  > 
  >
  > 2. ä¸è®ºæ˜¯`æ ¸å¿ƒæ¨¡å—`è¿˜æ˜¯`æ–‡ä»¶æ¨¡å—`ï¼Œrequire()æ–¹æ³•å¯¹ç›¸åŒæ¨¡å—çš„äºŒæ¬¡åŠ è½½éƒ½ä¸€å¾‹é‡‡ç”¨ç¼“å­˜ä¼˜å…ˆçš„æ–¹å¼ï¼Œè¿™æ˜¯**ç¬¬ä¸€ä¼˜å…ˆçº§**çš„ã€‚ä¸åŒä¹‹å¤„åœ¨äºæ ¸å¿ƒæ¨¡å—çš„ç¼“å­˜æ£€æŸ¥ä¼˜å…ˆæ–‡ä»¶æ¨¡å—çš„ç¼“å­˜æ£€æŸ¥



+ ç¼–è¯‘è¿‡ç¨‹ï¼š
  Nodeå¯¹è·å–çš„JavaScriptæ–‡ä»¶å†…å®¹è¿›è¡Œäº†å¤´å°¾åŒ…è£…ã€‚

  ```js
  (function (exports, require, module, __filename, __dirname) {
   // æˆ‘ä»¬çš„ä»£ç éƒ¨åˆ†
   var math = require('math');
   exports.area = function (radius) {
   return Math.PI * radius * radius;
   };
   // æˆ‘ä»¬çš„ä»£ç éƒ¨åˆ†ç»“æŸ
  }); 
  ```

  > åŒ…è£…ä¹‹åçš„ä»£ç ä¼šé€šè¿‡`vmåŸç”Ÿæ¨¡å—`çš„runInThisContext()æ–¹æ³•æ‰§è¡Œï¼ˆç±»ä¼¼evalï¼Œåªæ˜¯å…·æœ‰æ˜ç¡®ä¸Šä¸‹æ–‡ï¼Œä¸æ±¡æŸ“å…¨å±€ï¼‰ï¼Œè¿”å›ä¸€ä¸ªå…·ä½“çš„functionå¯¹è±¡ã€‚æœ€åï¼Œå°†å½“å‰æ¨¡å—å¯¹è±¡çš„exportså±æ€§ã€require()æ–¹æ³•ã€moduleï¼ˆæ¨¡å—å¯¹è±¡è‡ªèº«ï¼‰ï¼Œä»¥åŠåœ¨æ–‡ä»¶å®šä½ä¸­å¾—åˆ°çš„å®Œæ•´æ–‡ä»¶è·¯å¾„å’Œæ–‡ä»¶ç›®å½•ä½œä¸ºå‚æ•°ä¼ é€’ç»™è¿™ä¸ªfunction()æ‰§è¡Œã€‚

  ```js
  // 2.2.3.export.cjs
  const user = {
    name: 'xiaoqinvar'
  }
  
  // module.exports = user; // { name: 'xiaoqinvar' }
  // exports = user; // {}
  exports.user = user; // // { name: 'xiaoqinvar' }
  
  // 2.2.3.import.cjs
  const fileExport = require('./2.2.3.export.cjs');
  console.log(fileExport);
  ```

  > ç”¨exportsè¯æ˜ç¡®å®åŒ…è£…è¿‡ï¼Œexportsç›´æ¥èµ‹å€¼ç›¸å½“äºå°†å½¢å‚çš„æŒ‡é’ˆæŒ‡å‘äº†userå¯¹è±¡ï¼Œè€Œä¸åœ¨æ˜¯module.exportsï¼Œè€Œå¯¼å‡ºçš„æ˜¯module.exportsï¼Œæ­¤æ—¶module.exportä¸ºç©ºï¼Œè‡ªç„¶æ¥å—çš„æ˜¯ä¸ªç©ºå¯¹è±¡ï¼


+ C/C++æ¨¡å—ç¼–è¯‘

  > æ— éœ€ç¼–è¯‘è¿‡ç¨‹ï¼Œåªæœ‰åŠ è½½å’Œæ‰§è¡Œè¿‡ç¨‹ï¼Œæ‰§è¡Œæ–¹é¢é«˜äºJs

  

+ JSONæ–‡ä»¶ç¼–è¯‘

  > æ­¤æ–¹å¼æœ€ç®€å•ï¼ŒNodeåˆ©ç”¨fsæ¨¡å—åŒæ­¥è¯»å–JSONæ–‡ä»¶çš„å†…å®¹ä¹‹ åï¼Œè°ƒç”¨JSON.parse()æ–¹æ³•å¾—åˆ°å¯¹è±¡ï¼Œç„¶åå°†å®ƒèµ‹ç»™æ¨¡å—å¯¹è±¡çš„exportsï¼Œä»¥ä¾›å¤–éƒ¨è°ƒç”¨ï¼Œç¬¬ä¸€æ¬¡åŠ è½½ä¼šç¼“å­˜ï¼
  > <u>æ³¨æ„</u>ï¼šå¦‚æœä½ è¦åŠ è½½jsonæ–‡ä»¶ç›´æ¥require()ï¼Œè€Œä¸æ˜¯fsè¯»å–ï¼Œrequire()ä¼šç¼“å­˜

### æ ¸å¿ƒæ¨¡å—åŠ è½½è¿‡ç¨‹

+ C/C++æ ¸å¿ƒæ¨¡å—è¿è¡Œ

> C/C++ç¼–å†™ï¼Œ**æ€§èƒ½ä¸Šä¼˜äºè„šæœ¬è¯­è¨€**ï¼›å®ƒä»¬æ˜¯è¢«ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚**ä¸€æ—¦Nodeå¼€å§‹æ‰§è¡Œï¼Œå®ƒä»¬è¢«ç›´æ¥åŠ è½½è¿›å†…å­˜ä¸­**ï¼Œæ— é¡»å†æ¬¡åšæ ‡è¯†ç¬¦å®šä½ã€æ–‡ä»¶å®šä½ã€ç¼–è¯‘ç­‰è¿‡ç¨‹ï¼Œç›´æ¥å°±å¯æ‰§è¡Œ



+ javascriptè½¬å­˜c/c++è¿‡ç¨‹

  å¯åŠ¨æ—¶ï¼šNodeé‡‡ç”¨äº†V8é™„å¸¦çš„js2c.pyå·¥å…·ï¼Œå°†æ‰€æœ‰å†…ç½®çš„JavaScriptä»£ç ï¼ˆsrc/node.jså’Œlib/*.jsï¼‰ç”Ÿæˆnode_natives.hå¤´æ–‡ä»¶ï¼Œæ­¤è¿‡ç¨‹**jsä»£ç ä»¥å­—ç¬¦ä¸²çš„å½¢å¼å­˜å‚¨åœ¨nodeå‘½åç©ºé—´ä¸­**ï¼Œæ˜¯ä¸å¯ç›´æ¥æ‰§è¡Œçš„ã€‚

  å¯åŠ¨Nodeè¿›ç¨‹æ—¶ï¼šJavaScriptä»£ç ç›´æ¥åŠ è½½è¿›å†…å­˜ä¸­ã€‚æ‰€ä»¥æ ¸å¿ƒæ¨¡å—åŠ è½½æ¯”æ–‡ä»¶æ¨¡å—ä»ç£ç›˜ä¸­ä¸€å¤„ä¸€å¤„æŸ¥æ‰¾è¦å¿«å¾ˆå¤šã€‚



+ æŒ‚è½½javascriptæ ¸å¿ƒæ¨¡å—

  > æºæ–‡ä»¶é€šè¿‡process.binding('natives')å–å‡ºï¼Œç¼–è¯‘æˆåŠŸçš„æ ¸å¿ƒæ¨¡å—ç¼“å­˜åˆ°NativeModule._cacheå¯¹è±¡ä¸Šï¼Œæ–‡ä»¶æ¨¡å—åˆ™ç¼“å­˜åˆ°Module.\_cacheå¯¹è±¡ä¸Š



### åŠ è½½è¿‡ç¨‹å›¾è§£
![nodeåŠ è½½æ¨¡å—è¿‡ç¨‹](./packages/nodejs%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E7%AC%94%E8%AE%B0/images/node%E5%8A%A0%E8%BD%BD%E6%A8%A1%E5%9D%97%E8%BF%87%E7%A8%8B.png)

### åŠ è½½é¡ºåºå›¾è§£
![åŠ è½½é¡ºåºå›¾è§£](./packages/nodejs%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E7%AC%94%E8%AE%B0/images/node%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97%E3%80%81%E6%96%87%E4%BB%B6%E6%A8%A1%E5%9D%97%E5%8A%A0%E8%BD%BD%E9%A1%BA%E5%BA%8F.png)
