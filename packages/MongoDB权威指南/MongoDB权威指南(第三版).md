# MongoDB 权威指南(第三版)

## 第二章 入门指南

### 文档

1. 键中不能含有`\0`（空字符）。这个字符用于表示一个键的结束
2. `.`和`$`是特殊字符，只能在某些特定情况下使用(可以认为这两个字符属于保留字符)
3. 字段区分大小写，且不允许重复

```ts
// 下面两个文档是不同的
{"count" : 5}
{"Count" : 5}
// 重复不合法❌
{"greeting" : "Hello, world!", "greeting" : "Hello, MongoDB!"}
```

### 集合

集合：相当于关系型数据库的表

1. 集合名称不能是空字符串("")、空字符(\0)
2. 集合名称不能以`system.`开头，该前缀是为内部集合保留的。

> 🌰 例如，`system.users`集合中保存着数据库的用户，`system.namespaces`集合中保存着有关数据库所有集合的信息

3. 用户创建的集合名称中不应包含保留字符`$`

> 🌰 某些由系统生成的集合会包含它，除非你要访问的是这些集合之一，否则不应在名称中使用`$`字符

### 名称空间

- `名称空间`：将数据库名称与其中的集合名连起来，可以获得一个完全限定的集合名称

```ts
// 如果你要使用cms数据库中的blog.posts集合
// 则该集合的命名空间为：
cms.blog.posts;
```

> 💡 命名空间的长度限制为 120 字节，而实际使用时应该小于 100 字节

### shell

- shell：是一个 JavaScript 解释器，能够运行任意的 JavaScript 程序

```ts
Math.sin(Math.PI / 2); // 1
"hello mongodb!".repeat(2); // hello mongodb!hello mongodb!
```

- 定义方法

```ts
function double(num) {
  return num ** 2;
}
double(10); // 100
```

### 基本数据类型

1. null

2. boolean

3. 数值类型

   1. `浮点数`：默认使用 64 位浮点数来表示数值

   ```ts
   {"x" : 3.14}
   {"x" : 3}
   ```

   2. 对于整数：可以使用`NumberInt`或`NumberLong`类，它们分别表示 4 字节和 8 字节的有符号整数

   ```ts
   {"x" : NumberInt("3")} // 4字节大小整数，3
   {"x" : NumberLong("3")} // 8字节大小整数，3
   ```

4. 字符串：UTF8 字符串

5. 日期类型：存储为 64 位整数，表示自 Unix 纪元（1970 年 1 月 1 日）以来的`毫秒数`，不包含时区信息

6. 正则表达式：与 JS 的正则表达式语法相同

```ts
{"x" : /foobar/i}
```

7. 数组
8. 内嵌文档/对象

```ts
{
  "x" : {
    "foo" : "bar"
  }
}
```

9. ObjectID：是一个 12 字节的 ID，是文档的唯一标识

```ts
{"x": ObjectId()}
// {"x": ObjectId("636cd7a9e5a4c73cfd0eaee7")}
// 用24个十六进制数字组成的字符串来表示，每2个数字占1个字节，总共大小为12字节

// ObjectId生成原理
1  |  2  |  3  |  4  |  5  |  6  |  7  |  8  |  9  |  10  |  11  |  12  ｜
          时间戳      |           随机值             | 计数器（起始值随机）
// [1, 4]字节的时间戳和[5, 9]随机值为1s内提供了唯一性
// [1, 4]字节的时间戳隐含了文档创建时间
// 最后三字节：是一个计数器，以一个随机数作为起始值，用来避免分布式主键冲突问题
```

10. 二进制：是任意字节的字符串，不能通过 shell 操作；如果要将非 UTF-8 字符串存入数据库，那么使用二进制数据是唯一的方法。
11. 代码：存储 JS 代码

```ts
{"x" : function() { /* ... */ }}
```
